---
Id: 1013
Title: "Day 13 â€” Stratified Sampling: The Smart Way to Sample"
Author: Sughosh P Dixit
Date: "2025-11-13"
Tags: Data Science Statistics Sampling Stratified Sampling Variance Reduction Allocation Neyman Proportional
Topic: Data Science
Abstract: "Stratified sampling divides your population into groups and samples from each separately, guaranteeing coverage of important subgroups and dramatically reducing variance. Learn proportional, equal, and Neyman allocation strategies to maximize precision."
HeaderImage: /DS-13/stratified_sampling_intro.png
isPublished: true
---

# **Day 13 â€” Stratified Sampling: The Smart Way to Sample** ğŸ¯ğŸ“Š

<p style={{fontStyle: 'italic', color: '#666', marginTop: '1rem', textAlign: 'center'}}>Divide and conquer your sampling strategy for maximum precision.</p>

<Lottie animation="analyticsPulse" height={240} width={340} />

<p style={{fontStyle: 'italic', color: '#666', margin: '1rem 0 2rem', textAlign: 'center'}}>Stratified sampling guarantees coverage of important subgroups while reducing variance by 50-95% compared to simple random sampling.</p>

> ğŸ’¡ **Note:** This article uses technical terms and abbreviations. For definitions, check out the [Key Terms & Glossary](/key) page.

---

## ğŸ² The Random Sampling Trap

Imagine you're conducting a health survey in a company of 1,000 employees:

- 900 office workers (90%)

- 100 executives (10%)

You randomly sample 100 people. Here's what can go wrong:

**Unlucky Sample #1:**

```
Office workers: 95 people âœ…

Executives: 5 people ğŸ˜¬

Problem: Only 5 executives - can't say much about this group!
```

**Unlucky Sample #2:**

```
Office workers: 87 people ğŸ¤”

Executives: 13 people ğŸ¤·

Different from reality (90/10 split)!
```

**Unlucky Sample #3:**

```
Office workers: 100 people ğŸ˜±

Executives: 0 people ğŸ’€

Complete miss on executive health!
```

**The problem:** Simple Random Sampling (SRS) is... well, random! ğŸ²

**The solution:** Stratified Sampling - sample smartly within groups! ğŸ§ âœ¨

---

## ğŸ¯ What is Stratified Sampling?

**Stratified Sampling** means:

1. **Divide** population into non-overlapping groups (strata)

2. **Sample** from each stratum separately

3. **Combine** results with proper weighting

### Visual Comparison

**Simple Random Sampling (SRS):**

```
Population: ğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µ (office workers)

            ğŸ”´ (executive)

Random sample of 10:

Picked: ğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µ

Result: All office workers! ğŸ˜±
```

**Stratified Sampling:**

```
Population: 

  Stratum 1: ğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µ (90 office workers)

  Stratum 2: ğŸ”´ (10 executives)

Stratified sample of 10:

  From Stratum 1: ğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µğŸ”µ (9 people)

  From Stratum 2: ğŸ”´ (1 person)

Result: Proper representation! âœ…
```

---

## ğŸ¯ Why Stratify? Three Big Reasons

### 1. **Guaranteed Coverage** ğŸ›¡ï¸

**Problem with SRS:** Might miss rare but important groups

**Example:**

```
City population:

- Urban: 70%

- Suburban: 20%

- Rural: 10%

SRS of 100 might give:

Urban: 65, Suburban: 25, Rural: 10

OR

Urban: 75, Suburban: 22, Rural: 3  â† Rural underrepresented!
```

**Stratified solution:**

```
Explicitly sample from each:

Urban: 70 people (guaranteed)

Suburban: 20 people (guaranteed)

Rural: 10 people (guaranteed)

Coverage ensured! âœ…
```

### 2. **Variance Reduction** ğŸ“‰

**The Math Intuition:**

Variance comes from differences:

- **Between-stratum variance:** How different are the groups?

- **Within-stratum variance:** How different are people within each group?

**Key insight:** If strata are homogeneous (similar within), stratified sampling has lower variance than SRS!

**Visual:**

```
POPULATION (high variance):

Health scores: 45, 48, 50, 52, 85, 87, 88, 90, 91, 92

               â†‘_________â†‘  â†‘___________________â†‘

               Office       Executives

               (lower)      (higher)

Within-stratum variance:

Office: ÏƒÂ² = 6.5 (people similar)

Executive: ÏƒÂ² = 7.8 (people similar)

But between-stratum difference is HUGE (50 vs 90)!

SRS estimates affected by this big gap.

Stratified sampling accounts for it separately! âœ…
```

### 3. **Domain Insights** ğŸ”

**SRS result:**

```
"Average health score: 75"

Okay... but tells us nothing about groups!
```

**Stratified result:**

```
"Average health scores:

  Office workers: 52 (95% CI: 50-54)

  Executives: 88 (95% CI: 86-90)"

Rich insights about each segment! ğŸ¯
```

---

## ğŸ“Š The Math: How Much Better Is It?

### Variance Formula

**Simple Random Sampling variance:**

```
Var(È³_SRS) = ÏƒÂ²/n Ã— (N-n)/N

Where:

- ÏƒÂ² = overall population variance

- n = sample size

- N = population size

- (N-n)/N = finite population correction
```

**Stratified Sampling variance:**

```
Var(È³_strat) = Î£(Wâ‚•Â² Ã— Ïƒâ‚•Â²/nâ‚• Ã— (Nâ‚•-nâ‚•)/Nâ‚•)

Where:

- Wâ‚• = stratum h weight (Nâ‚•/N)

- Ïƒâ‚•Â² = variance within stratum h

- nâ‚• = sample size in stratum h

- Nâ‚• = population size in stratum h
```

**The Variance Reduction:**

```
Var(È³_SRS) - Var(È³_strat) = Î£ Wâ‚•(Î¼â‚• - Î¼)Â²

This is the between-stratum variance!
```

**Translation:** The more different your strata are, the bigger the variance reduction! ğŸ‰

### Example Calculation ğŸ§®

**Population:**

- Stratum 1 (Office): Nâ‚ = 900, Î¼â‚ = 50, Ïƒâ‚Â² = 100

- Stratum 2 (Executive): Nâ‚‚ = 100, Î¼â‚‚ = 90, Ïƒâ‚‚Â² = 64

- Total: N = 1000

**Sample: n = 100**

**Proportional allocation:**

- nâ‚ = 90 (90% of sample)

- nâ‚‚ = 10 (10% of sample)

#### SRS Variance:

First, calculate overall variance:

```
Î¼ = 0.9(50) + 0.1(90) = 45 + 9 = 54

ÏƒÂ² = 0.9(100 + (50-54)Â²) + 0.1(64 + (90-54)Â²)

   = 0.9(100 + 16) + 0.1(64 + 1296)

   = 0.9(116) + 0.1(1360)

   = 104.4 + 136

   = 240.4
```

```
Var(È³_SRS) = 240.4/100 Ã— (1000-100)/1000

           = 2.404 Ã— 0.9

           = 2.16
```

**Standard error:** âˆš2.16 = **1.47** ğŸ“

#### Stratified Variance:

```
Wâ‚ = 900/1000 = 0.9

Wâ‚‚ = 100/1000 = 0.1

Var(È³_strat) = 0.9Â² Ã— (100/90) Ã— (900-90)/900 

             + 0.1Â² Ã— (64/10) Ã— (100-10)/100

             

           = 0.81 Ã— 1.11 Ã— 0.9 

             + 0.01 Ã— 6.4 Ã— 0.9

             

           = 0.81 + 0.058

           = 0.87
```

**Standard error:** âˆš0.87 = **0.93** ğŸ“

#### The Improvement:

```
Variance reduction: 2.16 - 0.87 = 1.29 (60% reduction! ğŸ‰)

Standard error:

SRS: 1.47

Stratified: 0.93

Stratified is 58% more precise! âœ¨
```

**Translation:** To get the same precision with SRS, you'd need 2.5Ã— more samples!

---

## ğŸšï¸ Allocation Strategies: How Many Per Stratum?

Once you decide to stratify, how do you divide your sample across strata?

### 1. **Proportional Allocation** âš–ï¸ (Most Common)

**Rule:** Sample proportionally to stratum size

```
nâ‚• = n Ã— (Nâ‚•/N)
```

**Example:**

```
Population: 900 office, 100 executive (1000 total)

Sample size: n = 100

Office sample: 100 Ã— (900/1000) = 90

Executive sample: 100 Ã— (100/1000) = 10
```

**Pros:**

- âœ… Simple, intuitive

- âœ… Self-weighting (no complex weights needed)

- âœ… Represents population structure

**Cons:**

- âš ï¸ Small strata get small samples (might be imprecise)

### 2. **Equal Allocation** ğŸŸ°

**Rule:** Same sample size for each stratum

```
nâ‚• = n / H

Where H = number of strata
```

**Example:**

```
Population: 900 office, 100 executive

Sample size: n = 100

Strata: H = 2

Office sample: 100/2 = 50

Executive sample: 100/2 = 50
```

**Pros:**

- âœ… Good for comparing strata (equal precision)

- âœ… Ensures small strata have enough data

**Cons:**

- âš ï¸ Oversamples small strata (need complex weights)

- âš ï¸ Less efficient for overall mean estimation

### 3. **Neyman Allocation** ğŸ¯ (Optimal)

**Rule:** Allocate proportional to stratum size AND variance

```
nâ‚• = n Ã— (Nâ‚• Ã— Ïƒâ‚•) / Î£(Nâ‚– Ã— Ïƒâ‚–)
```

**Intuition:** Sample more from:

- Large strata (more people â†’ more important)

- High-variance strata (more diverse â†’ need more samples)

**Example:**

```
Stratum 1: Nâ‚ = 900, Ïƒâ‚ = 10

Stratum 2: Nâ‚‚ = 100, Ïƒâ‚‚ = 8

Stratum 1 weight: 900 Ã— 10 = 9,000

Stratum 2 weight: 100 Ã— 8 = 800

Total weight: 9,800

Office sample: 100 Ã— (9000/9800) = 91.8 â‰ˆ 92

Executive sample: 100 Ã— (800/9800) = 8.2 â‰ˆ 8
```

**Pros:**

- âœ… Mathematically optimal (minimizes variance!)

- âœ… Accounts for both size and heterogeneity

**Cons:**

- âš ï¸ Requires knowing Ïƒâ‚• in advance (often unknown!)

- âš ï¸ Might still undersample important small strata

### 4. **Optimal Allocation with Cost** ğŸ’°

**Rule:** Account for different sampling costs per stratum

```
nâ‚• = n Ã— (Nâ‚• Ã— Ïƒâ‚• / âˆšcâ‚•) / Î£(Nâ‚– Ã— Ïƒâ‚– / âˆšcâ‚–)

Where câ‚• = cost to sample one unit from stratum h
```

**Example:**

```
Executives cost 5Ã— more to survey (busy, need incentives)

câ‚ = $10 (office worker)

câ‚‚ = $50 (executive)

This would reduce executive sample further!
```

**Use when:** Budget constrained, different costs per stratum

---

## ğŸ“ˆ Visual: Variance vs Allocation

Let's see how variance changes with different allocations:

```
                    Variance (SEÂ²)

                         â”‚

                    3.0  â”‚

                         â”‚  â€¢  SRS

                    2.5  â”‚

                         â”‚

                    2.0  â”‚        â€¢ Equal

                         â”‚

                    1.5  â”‚

                         â”‚

                    1.0  â”‚               â€¢ Proportional

                         â”‚

                    0.5  â”‚                        â€¢ Neyman

                         â”‚                          (Optimal!)

                    0.0  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

                         Different Allocation Strategies

Lower is better! âœ…
```

**Takeaway:** Neyman always wins (if you know the variances)!

---

## ğŸ¨ğŸ”¬ Defining Strata: The Art and Science

**Good strata are:**

### 1. **Mutually Exclusive** ğŸš«

Each unit belongs to exactly one stratum

```
âŒ Bad: "Young", "Students"

   (Young students counted twice!)

âœ… Good: "Student", "Non-Student"
```

### 2. **Exhaustive** ğŸ“¦

Every unit belongs to some stratum

```
âŒ Bad: "<30", "40-60", ">60"

   (Missing 30-40 age range!)

âœ… Good: "<30", "30-40", "40-60", ">60"
```

### 3. **Homogeneous Within** ğŸŸ°

Units within stratum are similar

```
âŒ Bad stratum: "People" (too diverse!)

âœ… Good stratum: "Female doctors aged 40-50"
```

### 4. **Heterogeneous Between** ğŸ­

Strata are different from each other

```
âŒ Bad: "Age 30-40", "Age 31-41"

   (Too much overlap, not distinct!)

âœ… Good: "Age 18-30", "Age 31-50", "Age 51+"
```

### 5. **Meaningful** ğŸ’¡

Based on domain knowledge, not arbitrary

```
âŒ Bad: "First 500 rows", "Last 500 rows"

   (Arbitrary split!)

âœ… Good: "Urban", "Suburban", "Rural"

   (Meaningful demographic divisions)
```

### Common Stratification Variables:

**Demographics:**

- Age groups

- Gender

- Education level

- Income brackets

- Geographic region

**Business:**

- Customer segments (high/medium/low value)

- Product categories

- Time periods (Q1, Q2, Q3, Q4)

**Medical:**

- Disease severity (mild/moderate/severe)

- Treatment type

- Risk factors present/absent

---

## ğŸ“ Exercise: SRS vs Stratified Variance

Let's work through a complete example!

### The Setup

**Population of 20 people:**

**Stratum 1 (Group A) - 15 people:**

Values: [10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24]

```
Mean (Î¼â‚) = 17

Variance (Ïƒâ‚Â²) = 20

SD (Ïƒâ‚) = 4.47
```

**Stratum 2 (Group B) - 5 people:**

Values: [50, 52, 54, 56, 58]

```
Mean (Î¼â‚‚) = 54

Variance (Ïƒâ‚‚Â²) = 8

SD (Ïƒâ‚‚) = 2.83
```

**Overall population:**

```
N = 20

Î¼ = (15Ã—17 + 5Ã—54)/20 = (255 + 270)/20 = 26.25
```

**We want to sample n = 8 people.**

### Approach 1: Simple Random Sampling

**Variance calculation:**

First, overall variance:

```
ÏƒÂ² = Î£(xáµ¢ - Î¼)Â² / N

For stratum 1 contribution:

= (15/20) Ã— [Ïƒâ‚Â² + (Î¼â‚ - Î¼)Â²]

= 0.75 Ã— [20 + (17 - 26.25)Â²]

= 0.75 Ã— [20 + 85.56]

= 0.75 Ã— 105.56

= 79.17

For stratum 2 contribution:

= (5/20) Ã— [Ïƒâ‚‚Â² + (Î¼â‚‚ - Î¼)Â²]

= 0.25 Ã— [8 + (54 - 26.25)Â²]

= 0.25 Ã— [8 + 770.06]

= 0.25 Ã— 778.06

= 194.52

Total: ÏƒÂ² = 79.17 + 194.52 = 273.69
```

```
Var(È³_SRS) = ÏƒÂ²/n Ã— (N-n)/N

           = 273.69/8 Ã— (20-8)/20

           = 34.21 Ã— 0.6

           = 20.53
```

**Standard Error:** âˆš20.53 = **4.53** ğŸ“

### Approach 2: Proportional Stratified Sampling

**Sample allocation:**

```
nâ‚ = 8 Ã— (15/20) = 6

nâ‚‚ = 8 Ã— (5/20) = 2
```

**Variance calculation:**

```
Wâ‚ = 15/20 = 0.75

Wâ‚‚ = 5/20 = 0.25

Var(È³_strat) = Wâ‚Â² Ã— (Ïƒâ‚Â²/nâ‚) Ã— (Nâ‚-nâ‚)/Nâ‚ 

             + Wâ‚‚Â² Ã— (Ïƒâ‚‚Â²/nâ‚‚) Ã— (Nâ‚‚-nâ‚‚)/Nâ‚‚

             

           = 0.75Â² Ã— (20/6) Ã— (15-6)/15

             + 0.25Â² Ã— (8/2) Ã— (5-2)/5

             

           = 0.5625 Ã— 3.33 Ã— 0.6

             + 0.0625 Ã— 4 Ã— 0.6

             

           = 1.125 + 0.15

           = 1.275
```

**Standard Error:** âˆš1.275 = **1.13** ğŸ“

### Approach 3: Neyman Allocation

**Optimal allocation:**

```
Stratum 1: Nâ‚ Ã— Ïƒâ‚ = 15 Ã— 4.47 = 67.05

Stratum 2: Nâ‚‚ Ã— Ïƒâ‚‚ = 5 Ã— 2.83 = 14.15

Total: 81.20

nâ‚ = 8 Ã— (67.05/81.20) = 6.6 â‰ˆ 7

nâ‚‚ = 8 Ã— (14.15/81.20) = 1.4 â‰ˆ 1
```

**Variance calculation:**

```
Var(È³_Neyman) = 0.75Â² Ã— (20/7) Ã— 0.53

              + 0.25Â² Ã— (8/1) Ã— 0.8

              

            = 0.5625 Ã— 2.86 Ã— 0.53

              + 0.0625 Ã— 8 Ã— 0.8

              

            = 0.85 + 0.40

            = 1.25
```

**Standard Error:** âˆš1.25 = **1.12** ğŸ“

### The Comparison Table ğŸ“Š

| Method | nâ‚ | nâ‚‚ | Variance | SE | Efficiency |

|--------|----|----|----------|-----|------------|

| **SRS** | varies | varies | 20.53 | 4.53 | 1.00Ã— |

| **Proportional** | 6 | 2 | 1.275 | 1.13 | 16.1Ã— ğŸ‰ |

| **Neyman** | 7 | 1 | 1.25 | 1.12 | 16.4Ã— ğŸ† |

**Key Insights:**

âœ… **Stratified sampling reduces variance by 94%!** (From 20.53 to 1.27)

âœ… **Why?** The two groups are VERY different (means of 17 vs 54), but within each group, people are similar

âœ… **Neyman only slightly better than proportional** (1.25 vs 1.275) - proportional is good enough!

âœ… **To match stratified precision with SRS, you'd need 129 samples instead of 8!** (16Ã— more)

### Visual Representation ğŸ“Š

```
Standard Error Comparison

SRS:         â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ (4.53)

Proportional: â–ˆâ–ˆâ–ˆ (1.13)

Neyman:       â–ˆâ–ˆâ–ˆ (1.12)

Shorter bars = Better (more precise)! âœ…
```

---

## ğŸ Python Implementation

### perform_stratification Function

```python
import pandas as pd
import numpy as np

def perform_stratification(df, stratum_col, target_col, 
                          sample_size, allocation='proportional'):
    """
    Perform stratified sampling
    
    Parameters:
    - df: DataFrame
    - stratum_col: Column defining strata
    - target_col: Variable of interest
    - sample_size: Total sample size
    - allocation: 'proportional', 'equal', or 'neyman'
    
    Returns:
    - sample_df: Stratified sample
    - summary: Allocation summary
    """
    
    # Calculate stratum statistics
    stratum_stats = df.groupby(stratum_col).agg({
        target_col: ['count', 'mean', 'std']
    }).reset_index()
    
    stratum_stats.columns = [stratum_col, 'N', 'mean', 'std']
    stratum_stats['weight'] = stratum_stats['N'] / len(df)
    
    # Calculate sample sizes per stratum
    if allocation == 'proportional':
        stratum_stats['n'] = (
            sample_size * stratum_stats['weight']
        ).round().astype(int)
        
    elif allocation == 'equal':
        n_strata = len(stratum_stats)
        stratum_stats['n'] = sample_size // n_strata
        
    elif allocation == 'neyman':
        # Optimal allocation
        stratum_stats['allocation_weight'] = (
            stratum_stats['N'] * stratum_stats['std']
        )
        total_weight = stratum_stats['allocation_weight'].sum()
        stratum_stats['n'] = (
            sample_size * stratum_stats['allocation_weight'] / total_weight
        ).round().astype(int)
    
    # Adjust for rounding errors
    total_allocated = stratum_stats['n'].sum()
    if total_allocated != sample_size:
        diff = sample_size - total_allocated
        # Add/subtract from largest stratum
        largest_idx = stratum_stats['N'].idxmax()
        stratum_stats.loc[largest_idx, 'n'] += diff
    
    # Perform stratified sampling
    sample_dfs = []
    for _, row in stratum_stats.iterrows():
        stratum_data = df[df[stratum_col] == row[stratum_col]]
        stratum_sample = stratum_data.sample(
            n=int(row['n']), 
            replace=False,
            random_state=42
        )
        sample_dfs.append(stratum_sample)
    
    sample_df = pd.concat(sample_dfs, ignore_index=True)
    
    return sample_df, stratum_stats

def show_stratification_summary(stratum_stats, allocation_type):
    """
    Display stratification summary with variance estimates
    """
    print(f"\n{'='*60}")
    print(f"Stratification Summary - {allocation_type.title()} Allocation")
    print(f"{'='*60}\n")
    
    print(stratum_stats.to_string(index=False))
    
    # Calculate overall variance
    total_n = stratum_stats['n'].sum()
    
    variance_components = (
        stratum_stats['weight']**2 * 
        stratum_stats['std']**2 / stratum_stats['n'] *
        (stratum_stats['N'] - stratum_stats['n']) / stratum_stats['N']
    )
    
    total_variance = variance_components.sum()
    se = np.sqrt(total_variance)
    
    print(f"\n{'='*60}")
    print(f"Overall Variance: {total_variance:.4f}")
    print(f"Standard Error: {se:.4f}")
    print(f"{'='*60}\n")
    
    return total_variance, se
```

### Usage Example

```python
# Create toy dataset
np.random.seed(42)
df = pd.DataFrame({
    'group': ['A']*150 + ['B']*50,
    'value': np.concatenate([
        np.random.normal(50, 10, 150),  # Group A
        np.random.normal(90, 8, 50)     # Group B
    ])
})

# Proportional allocation
sample_prop, stats_prop = perform_stratification(
    df, 'group', 'value', 
    sample_size=100, 
    allocation='proportional'
)
var_prop, se_prop = show_stratification_summary(stats_prop, 'proportional')

# Neyman allocation
sample_neyman, stats_neyman = perform_stratification(
    df, 'group', 'value',
    sample_size=100,
    allocation='neyman'
)
var_neyman, se_neyman = show_stratification_summary(stats_neyman, 'neyman')

# Compare with SRS
overall_std = df['value'].std()
var_srs = overall_std**2 / 100 * (200-100)/200
se_srs = np.sqrt(var_srs)

print(f"\nComparison:")
print(f"SRS SE: {se_srs:.4f}")
print(f"Proportional SE: {se_prop:.4f} ({(1-se_prop/se_srs)*100:.1f}% reduction)")
print(f"Neyman SE: {se_neyman:.4f} ({(1-se_neyman/se_srs)*100:.1f}% reduction)")
```

---

## ğŸ¯ When to Use Stratified Sampling

### Perfect For:

âœ… **Known subgroups** that differ meaningfully

- Demographics (age, gender, region)

- Business segments (customer tiers)

- Risk categories (low/medium/high)

âœ… **Small important groups** you must include

- Rare diseases

- Executive opinions

- Minority populations

âœ… **Variance reduction** is critical

- Limited budget (need maximum precision)

- Policy decisions (small errors matter)

- Clinical trials (safety critical)

âœ… **Domain insights** needed per group

- Compare regions

- Track segments over time

- Identify disparities

### Don't Use When:

âŒ **No clear strata** exist

- Homogeneous population

- Unknown groupings

- Exploratory research (don't know what matters)

âŒ **Stratum information unavailable** at sampling time

- Can't identify strata before sampling

- Post-hoc stratification (use weighting instead)

âŒ **Very small sample sizes**

- n < 30: Stratification overhead not worth it

- Not enough samples per stratum

âŒ **Cost prohibitive**

- Different strata require vastly different effort

- Geographic dispersion makes stratified sampling impractical

---

## âš ï¸ Common Pitfalls

### 1. **Too Many Strata** ğŸš«

```
âŒ Bad: 20 strata with n=100 samples

   â†’ 5 samples per stratum (unreliable!)

âœ… Good: 4-5 strata with n=100 samples

   â†’ 20-25 per stratum (stable estimates)
```

**Rule of thumb:** At least 10-15 samples per stratum

### 2. **Ignoring Weights** ğŸš«

With non-proportional allocation, you MUST weight results:

```python
# Wrong (unweighted)
overall_mean = sample_df['value'].mean()

# Right (weighted)
stratum_means = sample_df.groupby('stratum')['value'].mean()
stratum_weights = population_stratum_sizes / population_total
overall_mean = (stratum_means * stratum_weights).sum()
```

### 3. **Defining Overlapping Strata** ğŸš«

```
âŒ Bad:

   Stratum A: "Students"

   Stratum B: "Age < 25"

   â†’ Young students belong to both!

âœ… Good:

   Stratum A: "Student, Age < 25"

   Stratum B: "Student, Age â‰¥ 25"

   Stratum C: "Non-student, Age < 25"

   Stratum D: "Non-student, Age â‰¥ 25"
```

### 4. **Forgetting Finite Population Correction** ğŸš«

When sampling a large fraction of the stratum:

```python
# Include FPC
var_stratum = (sigmaÂ²/n) * (N-n)/N

# Not just
var_stratum = sigmaÂ²/n  # Wrong!
```

---

## ğŸŒŸ Takeaway

Stratified sampling is the "divide and conquer" of sampling:

### Key Concepts:

âœ… **Strata** = non-overlapping, exhaustive groups

âœ… **Proportional allocation** = sample proportionally (simple, self-weighting)

âœ… **Neyman allocation** = optimal (proportional to Nâ‚• Ã— Ïƒâ‚•)

âœ… **Variance reduction** = can be 50-95% lower than SRS!

âœ… **Coverage guarantee** = ensures rare groups included

âœ… **Domain insights** = separate estimates per stratum

### The Math Win:

```
Variance reduction = Î£ Wâ‚•(Î¼â‚• - Î¼)Â²

Translation: The more different your strata, 

the bigger the improvement! ğŸ“ˆ
```

### Allocation Decision Tree:

```
Do you know Ïƒâ‚• for each stratum?

â”‚

â”œâ”€ Yes â†’ Use Neyman (optimal!) ğŸ†

â”‚

â””â”€ No â†’ Do you need equal precision per stratum?

         â”‚

         â”œâ”€ Yes â†’ Use Equal allocation âš–ï¸

         â”‚

         â””â”€ No â†’ Use Proportional (simplest) âœ…
```

### Real Impact:

In our exercise, stratified sampling gave **16Ã— more precision** than SRS with the same sample size. That's like getting 129 samples for the price of 8! ğŸ’°âœ¨

---

## ğŸ“š References

1. Cochran, W. G. (1977). *Sampling Techniques* (3rd ed.). John Wiley & Sons.

2. Lohr, S. L. (2019). *Sampling: Design and Analysis* (3rd ed.). Chapman and Hall/CRC.

3. Kish, L. (1965). *Survey Sampling*. John Wiley & Sons.

4. Neyman, J. (1934). On the two different aspects of the representative method: The method of stratified sampling and the method of purposive selection. *Journal of the Royal Statistical Society*, 97(4), 558-625.

5. SÃ¤rndal, C. E., Swensson, B., & Wretman, J. (1992). *Model Assisted Survey Sampling*. Springer-Verlag.

6. Thompson, S. K. (2012). *Sampling* (3rd ed.). John Wiley & Sons.

7. Valliant, R., Dever, J. A., & Kreuter, F. (2018). *Practical Tools for Designing and Weighting Survey Samples* (2nd ed.). Springer.

8. Groves, R. M., Fowler, F. J., Couper, M. P., Lepkowski, J. M., Singer, E., & Tourangeau, R. (2009). *Survey Methodology* (2nd ed.). John Wiley & Sons.

9. Little, R. J., & Rubin, D. B. (2019). *Statistical Analysis with Missing Data* (3rd ed.). John Wiley & Sons.

10. Lumley, T. (2010). *Complex Surveys: A Guide to Analysis Using R*. John Wiley & Sons.

---

<div style={{textAlign: 'center', margin: '3rem 0', padding: '2rem', background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)', borderRadius: '15px', color: 'white'}}>
  <div id="lottie-celebration" style={{width: '200px', height: '200px', margin: '0 auto'}}></div>
  <h3 style={{margin: '1rem 0', color: 'white'}}>Day 13 Complete! ğŸ‰</h3>
  <p style={{margin: 0, fontSize: '1.1rem', opacity: 0.9}}>*This is Day 13 of my 30-day challenge documenting my Data Science journey at Oracle! Stay tuned for more insights and mathematical foundations of data science. ğŸš€*</p>
  <div style={{marginTop: '1.5rem'}}>
    <p style={{margin: 0, fontSize: '0.9rem', opacity: 0.9}}>Next: Day 14 - Power Analysis and Sample Size Calculation, where we'll figure out how many samples you REALLY need to detect an effect! ğŸ“ŠğŸ”¬</p>
  </div>
</div>

> ğŸ’¡ **Note:** This article uses technical terms like [stratified sampling](/key), [variance reduction](/key), [allocation](/key), [Neyman allocation](/key), and [finite population correction](/key). For definitions, check out the [Key Terms & Glossary](/key) page.

