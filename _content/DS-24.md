---
Id: 1024
Title: "Day 24: Risk Segmentation - Priority Tiers as Priors and Costs"
Author: Sughosh P Dixit
Date: "2025-11-24"
Tags: Data Science Risk Segmentation Cost-Sensitive Learning Bayes Threshold Decision Theory Classification Priors
Topic: Data Science
Abstract: "Learn to interpret priority tiers as prior beliefs or cost weights. Understand cost-sensitive thresholding, Bayes optimal decision rules, and how per-tier thresholds change labeling geometry through iso-cost analysis."
HeaderImage: /DS-24/risk_segmentation_intro.png
isPublished: true
---

# **Day 24: Risk Segmentation - Priority Tiers as Priors and Costs** âš–ï¸ğŸ“Š

<p style={{fontStyle: 'italic', color: '#666', marginTop: '1rem', textAlign: 'center'}}>Interpret priority tiers as prior beliefs or cost weights. Learn cost-sensitive thresholding and Bayes optimal decisions.</p>

<Lottie animation="analyticsPulse" height={240} width={340} caption="Risk segmentation assigns different decision thresholds based on prior beliefs and misclassification costs, optimizing overall decision quality." />

<p style={{fontStyle: 'italic', color: '#666', margin: '1rem 0 2rem', textAlign: 'center'}}>When different types of errors have different costs, a single threshold isn't optimal. Risk segmentation lets us tune decisions per segment, balancing precision and recall based on business needs.</p>

> ğŸ’¡ **Note:** This article uses technical terms and abbreviations. For definitions, check out the [Key Terms & Glossary](/key) page.

---

## The Problem: One Threshold Doesn't Fit All ğŸ¯

**Scenario:** You have an anomaly detection system with four priority tiers:

- **Critical:** High-priority entities requiring immediate attention
- **High:** Elevated concern, needs investigation
- **Standard:** Normal entities, low anomaly rate
- **Baseline:** Verified trusted entities, minimal intervention

**Question:** Should you use the same decision threshold for all tiers?

**Answer:** No! Different tiers have different:
- **Prior probabilities** (base rates of anomalies)
- **Misclassification costs** (cost of false positives vs false negatives)

**The insight:** Priority tiers encode our **prior beliefs** and **cost preferences**! ğŸ’¡

---

## Priority Tiers as Prior Beliefs ğŸ²

### What are Priors?

**Prior probability** (Ï€) is our belief about class proportions *before* seeing the score.

**Notation:**
- Ï€â‚ = P(Anomaly) = Prior probability of positive class
- Ï€â‚€ = P(Normal) = Prior probability of negative class
- Ï€â‚€ + Ï€â‚ = 1

### Different Priors by Priority Tier

**Example:**
```
Tier       Ï€â‚ (Anomaly Rate)    Ï€â‚€ (Normal)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Critical   0.30 (30%)           0.70 (70%)
High       0.10 (10%)           0.90 (90%)
Standard   0.02 (2%)            0.98 (98%)
Baseline   0.001 (0.1%)         0.999 (99.9%)
```

**Interpretation:**
- **Critical:** 1 in 3 events is an anomaly (high prior)
- **High:** 1 in 10 events is an anomaly
- **Standard:** 1 in 50 events is an anomaly
- **Baseline:** 1 in 1000 events is an anomaly (very low prior)

**Visual Example:**

<img src="/DS-24/prior_by_segment.png" alt="Prior Probabilities by Priority Tier" style={{maxWidth: '100%', height: 'auto', display: 'block', margin: '1.5rem auto', borderRadius: '8px'}} />

<Lottie animation="robustWorkflow" height={220} width={320} caption="Prior probabilities reflect our baseline expectations for each priority tier before examining individual scores." />

---

## Priority Tiers as Cost Weights ğŸ’°

### Misclassification Costs

Not all errors are equal! We define:

- **Câ‚€â‚ (False Positive Cost):** Cost of flagging a normal entity
  - Wasted resources, unnecessary investigation, user friction
- **Câ‚â‚€ (False Negative Cost):** Cost of missing an anomaly
  - Missed opportunity, undetected issue, downstream impact

### Cost Matrix

```
                    Predicted
                 Negative  Positive
Actual  Negative    0        Câ‚€â‚
        Positive   Câ‚â‚€        0
```

### Different Costs by Priority Tier

**Example:**
```
Tier       Câ‚â‚€ (Miss Anomaly)    Câ‚€â‚ (False Alarm)    Ratio Câ‚â‚€/Câ‚€â‚
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Critical   $10,000               $50                  200:1
High       $5,000                $100                 50:1
Standard   $1,000                $200                 5:1
Baseline   $500                  $500                 1:1
```

**Interpretation:**
- **Critical:** Missing anomaly is 200Ã— worse than false alarm â†’ Be aggressive!
- **High:** Missing anomaly is 50Ã— worse â†’ Still favor catching anomalies
- **Standard:** Missing anomaly is 5Ã— worse â†’ More balanced
- **Baseline:** Costs are equal â†’ Standard threshold

**Visual Example:**

<img src="/DS-24/cost_by_segment.png" alt="Cost Weights by Priority Tier" style={{maxWidth: '100%', height: 'auto', display: 'block', margin: '1.5rem auto', borderRadius: '8px'}} />

---

## Cost-Sensitive Thresholding âš–ï¸

### The Standard Threshold

Without cost considerations, we typically use Ï„ = 0.5:
- If P(Anomaly|x) â‰¥ 0.5, predict Positive
- If P(Anomaly|x) < 0.5, predict Negative

### The Bayes Optimal Threshold

With unequal costs and priors, the optimal threshold shifts!

**Bayes Decision Rule:**

Predict Positive (Anomaly) if:
```
P(Anomaly|x) Â· Câ‚â‚€ > P(Normal|x) Â· Câ‚€â‚
```

Rearranging:
```
P(Anomaly|x) / P(Normal|x) > Câ‚€â‚ / Câ‚â‚€
```

Using odds notation:
```
Odds(Anomaly|x) > Câ‚€â‚ / Câ‚â‚€
```

### Deriving the Threshold

**Optimal Threshold Formula:**
```
Ï„* = Câ‚€â‚ / (Câ‚€â‚ + Câ‚â‚€)
```

Or equivalently, incorporating priors:
```
Ï„* = 1 / (1 + (Câ‚â‚€/Câ‚€â‚) Â· (Ï€â‚/Ï€â‚€))
```

**Alternative form (likelihood ratio threshold):**
```
Ï„_LR = (Câ‚€â‚/Câ‚â‚€) Â· (Ï€â‚€/Ï€â‚)
```

**Visual Example:**

<img src="/DS-24/bayes_threshold.png" alt="Bayes Optimal Threshold" style={{maxWidth: '100%', height: 'auto', display: 'block', margin: '1.5rem auto', borderRadius: '8px'}} />

<Lottie animation="breakdownFortress" height={220} width={320} caption="The Bayes optimal threshold balances the costs of different types of errors, shifting based on cost ratios and prior probabilities." />

---

## Per-Tier Thresholds: Changing Labeling Geometry ğŸ“

### Computing Tier-Specific Thresholds

Using the formula Ï„* = Câ‚€â‚ / (Câ‚€â‚ + Câ‚â‚€):

```
Tier       Câ‚â‚€      Câ‚€â‚     Ï„* = Câ‚€â‚/(Câ‚€â‚+Câ‚â‚€)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Critical   $10,000  $50     50/(50+10000) = 0.005
High       $5,000   $100    100/(100+5000) = 0.020
Standard   $1,000   $200    200/(200+1000) = 0.167
Baseline   $500     $500    500/(500+500) = 0.500
```

**Interpretation:**
- **Critical (Ï„* = 0.005):** Flag anything with >0.5% anomaly probability
- **High (Ï„* = 0.020):** Flag anything with >2% anomaly probability
- **Standard (Ï„* = 0.167):** Flag anything with >16.7% anomaly probability
- **Baseline (Ï„* = 0.500):** Standard 50% threshold

### Impact on Labeling

**Lower threshold â†’ More events flagged (higher recall, lower precision)**
**Higher threshold â†’ Fewer events flagged (higher precision, lower recall)**

**Visual Example:**

<img src="/DS-24/per_risk_thresholds.png" alt="Per-Tier Thresholds" style={{maxWidth: '100%', height: 'auto', display: 'block', margin: '1.5rem auto', borderRadius: '8px'}} />

---

## Visualizing: PR Curves at Different Costs ğŸ“ˆ

### What Changes with Cost?

The **same model** produces different operating points when costs change.

On a Precision-Recall curve:
- Each threshold corresponds to a (Precision, Recall) point
- Different costs select different optimal points
- Higher Câ‚â‚€/Câ‚€â‚ ratio â†’ Move toward higher recall

### Three Operating Points

**Example with three cost scenarios:**

```
Scenario         Câ‚â‚€/Câ‚€â‚    Optimal Ï„    Precision    Recall
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Conservative     1:1        0.50         85%          40%
Balanced         10:1       0.09         60%          75%
Aggressive       100:1      0.01         30%          95%
```

**Visual Example:**

<img src="/DS-24/pr_curve_costs.png" alt="PR Curve with Different Cost Points" style={{maxWidth: '100%', height: 'auto', display: 'block', margin: '1.5rem auto', borderRadius: '8px'}} />

---

## Iso-Cost Lines: Visualizing Cost Trade-offs ğŸ“Š

### What are Iso-Cost Lines?

**Iso-cost lines** connect points with equal expected cost on the ROC or PR space.

**Formula (ROC space):**
```
Expected Cost = Câ‚€â‚ Â· Ï€â‚€ Â· FPR + Câ‚â‚€ Â· Ï€â‚ Â· FNR
              = Câ‚€â‚ Â· Ï€â‚€ Â· FPR + Câ‚â‚€ Â· Ï€â‚ Â· (1 - TPR)
```

For constant cost C:
```
TPR = 1 - (C - Câ‚€â‚ Â· Ï€â‚€ Â· FPR) / (Câ‚â‚€ Â· Ï€â‚)
```

This is a **linear equation** with slope:
```
slope = (Câ‚€â‚ Â· Ï€â‚€) / (Câ‚â‚€ Â· Ï€â‚)
```

### Reading Iso-Cost Lines

**Properties:**
- Lines closer to top-left corner = lower cost
- Slope depends on cost ratio and priors
- Optimal point = where ROC curve is tangent to iso-cost line

**Different slopes for different tiers:**
```
Tier       Slope = (Câ‚€â‚Â·Ï€â‚€)/(Câ‚â‚€Â·Ï€â‚)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Critical   (50Â·0.70)/(10000Â·0.30) = 0.012
High       (100Â·0.90)/(5000Â·0.10) = 0.18
Standard   (200Â·0.98)/(1000Â·0.02) = 9.8
Baseline   (500Â·0.999)/(500Â·0.001) = 999
```

**Visual Example:**

<img src="/DS-24/iso_cost_lines.png" alt="Iso-Cost Lines on ROC Space" style={{maxWidth: '100%', height: 'auto', display: 'block', margin: '1.5rem auto', borderRadius: '8px'}} />

<Lottie animation="classicalVsRobust" height={220} width={320} caption="Iso-cost lines help visualize how different cost structures lead to different optimal operating points on the ROC curve." />

---

## Baseline Tier Handling: Special Case ğŸ”’

### What Makes Baseline Different?

**Baseline** tier entities often receive special treatment:

1. **Very low prior:** Ï€â‚ â‰ˆ 0.001 or less
2. **Equal or inverted costs:** Câ‚€â‚ â‰¥ Câ‚â‚€ (false positives hurt more)
3. **Business rules:** May bypass scoring entirely

### Baseline Handling Strategies

**Strategy 1: High Threshold**
```
Ï„_baseline = 0.90  (Only flag very high scores)
```

**Strategy 2: Bypass**
```
if tier == "Baseline":
    return "Auto-Approve"  # Skip scoring
```

**Strategy 3: Score but Don't Flag**
```
# Score for monitoring, but don't take action
if tier == "Baseline":
    tag = "Monitor-Only"
```

### Impact on Labeling Geometry

When Baseline uses different rules:
- The decision boundary shifts dramatically
- Creates discontinuity in the overall labeling
- Requires careful tracking of tier-specific metrics

**Visual Example:**

<img src="/DS-24/nr_handling.png" alt="Baseline Tier Handling Strategies" style={{maxWidth: '100%', height: 'auto', display: 'block', margin: '1.5rem auto', borderRadius: '8px'}} />

---

## Real-World Application: Per-Tier Threshold Configuration ğŸ”§

### Configuration Structure

```python
tier_config = {
    'Critical': {
        'prior': 0.30,
        'cost_fn': 10000,  # Câ‚â‚€: cost of missing anomaly
        'cost_fp': 50,     # Câ‚€â‚: cost of false positive
        'threshold': 0.005,
        'action': 'flag_for_review'
    },
    'High': {
        'prior': 0.10,
        'cost_fn': 5000,
        'cost_fp': 100,
        'threshold': 0.020,
        'action': 'flag_for_review'
    },
    'Standard': {
        'prior': 0.02,
        'cost_fn': 1000,
        'cost_fp': 200,
        'threshold': 0.167,
        'action': 'flag_if_above'
    },
    'Baseline': {
        'prior': 0.001,
        'cost_fn': 500,
        'cost_fp': 500,
        'threshold': 0.500,
        'action': 'auto_approve'
    }
}
```

### Applying Per-Tier Thresholds

```python
def apply_tier_threshold(event, score, tier_config):
    """
    Apply tier-specific threshold to determine action.
    
    Parameters:
    - event: Event dictionary with 'priority_tier'
    - score: Model score (probability)
    - tier_config: Configuration dictionary
    
    Returns:
    - action: 'flag', 'approve', or 'monitor'
    """
    tier = event['priority_tier']
    config = tier_config[tier]
    threshold = config['threshold']
    
    if config['action'] == 'auto_approve':
        return 'approve'
    elif score >= threshold:
        return 'flag'
    else:
        return 'approve'
```

---

## Exercise: Deriving the Decision Threshold ğŸ“

### The Problem

**Given:**
- Two classes with Gaussian score distributions
- Class 0 (Normal): N(Î¼â‚€, ÏƒÂ²)
- Class 1 (Anomaly): N(Î¼â‚, ÏƒÂ²) where Î¼â‚ > Î¼â‚€
- Priors: Ï€â‚€, Ï€â‚
- Costs: Câ‚€â‚ (false positive), Câ‚â‚€ (false negative)

**Derive:** The optimal decision threshold Ï„*

### Solution

**Step 1: Bayes Decision Rule**

Predict Class 1 (Anomaly) if:
```
Ï€â‚ Â· P(x|Class 1) Â· Câ‚â‚€ > Ï€â‚€ Â· P(x|Class 0) Â· Câ‚€â‚
```

**Step 2: Likelihood Ratio**

Rearranging:
```
P(x|Class 1) / P(x|Class 0) > (Câ‚€â‚/Câ‚â‚€) Â· (Ï€â‚€/Ï€â‚)
```

Let Î» = (Câ‚€â‚/Câ‚â‚€) Â· (Ï€â‚€/Ï€â‚) be the **threshold likelihood ratio**.

**Step 3: Gaussian Likelihood Ratio**

For Gaussian distributions with equal variance:
```
P(x|Class 1) / P(x|Class 0) = exp[-(x-Î¼â‚)Â²/2ÏƒÂ² + (x-Î¼â‚€)Â²/2ÏƒÂ²]
                            = exp[(Î¼â‚-Î¼â‚€)(2x-Î¼â‚-Î¼â‚€) / 2ÏƒÂ²]
```

**Step 4: Solve for Threshold**

Setting likelihood ratio = Î»:
```
(Î¼â‚-Î¼â‚€)(2x-Î¼â‚-Î¼â‚€) / 2ÏƒÂ² = ln(Î»)
```

Solving for x:
```
Ï„* = (Î¼â‚ + Î¼â‚€)/2 + ÏƒÂ² Â· ln(Î») / (Î¼â‚ - Î¼â‚€)
```

**Step 5: Simplify**

Substituting Î» = (Câ‚€â‚/Câ‚â‚€) Â· (Ï€â‚€/Ï€â‚):
```
Ï„* = (Î¼â‚ + Î¼â‚€)/2 + ÏƒÂ² Â· ln[(Câ‚€â‚/Câ‚â‚€) Â· (Ï€â‚€/Ï€â‚)] / (Î¼â‚ - Î¼â‚€)
```

### Interpretation

The optimal threshold has two components:

1. **Midpoint:** (Î¼â‚ + Î¼â‚€)/2 â€” where distributions cross
2. **Shift:** Adjustment based on costs and priors

**When Câ‚â‚€ > Câ‚€â‚ (missing anomaly is worse):**
- Î» < 1, ln(Î») < 0
- Threshold shifts left (lower)
- More events flagged

**When Ï€â‚ > Ï€â‚€ (anomalies are common):**
- Î» smaller
- Threshold shifts left
- More events flagged

**Visual Example:**

<img src="/DS-24/gaussian_threshold.png" alt="Gaussian Score Distributions and Optimal Threshold" style={{maxWidth: '100%', height: 'auto', display: 'block', margin: '1.5rem auto', borderRadius: '8px'}} />

---

## Best Practices for Tier-Based Thresholding âœ…

### 1. Estimate Priors Carefully

- Use historical data to estimate tier-specific anomaly rates
- Update priors regularly as patterns change
- Consider seasonal variations

### 2. Quantify Costs Explicitly

- Work with business stakeholders to define costs
- Include both direct and indirect costs
- Document assumptions

### 3. Validate Thresholds Empirically

- Backtest on historical data
- Monitor performance by tier
- Adjust based on observed outcomes

### 4. Handle Edge Cases

- Define behavior for missing tiers
- Plan for new/unknown priority categories
- Set sensible defaults

### 5. Document Everything

- Record threshold derivations
- Track cost assumptions
- Log threshold changes over time

### 6. Monitor Tier Drift

- Watch for changes in tier composition
- Alert on significant prior shifts
- Recalibrate periodically

---

## Summary Table ğŸ“‹

<table>
<thead>
<tr>
<th>Concept</th>
<th>Formula</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Prior Probability</strong></td>
<td>Ï€â‚ = P(Anomaly)</td>
<td>Base rate of positive class</td>
</tr>
<tr>
<td><strong>Cost Ratio</strong></td>
<td>Câ‚â‚€ / Câ‚€â‚</td>
<td>How much worse is missing anomaly vs false alarm</td>
</tr>
<tr>
<td><strong>Bayes Threshold</strong></td>
<td>Ï„* = Câ‚€â‚ / (Câ‚€â‚ + Câ‚â‚€)</td>
<td>Cost-optimal decision boundary</td>
</tr>
<tr>
<td><strong>Likelihood Ratio</strong></td>
<td>Î» = (Câ‚€â‚/Câ‚â‚€) Â· (Ï€â‚€/Ï€â‚)</td>
<td>Threshold in likelihood space</td>
</tr>
<tr>
<td><strong>Iso-Cost Slope</strong></td>
<td>(Câ‚€â‚ Â· Ï€â‚€) / (Câ‚â‚€ Â· Ï€â‚)</td>
<td>Slope of equal-cost lines in ROC</td>
</tr>
<tr>
<td><strong>Gaussian Threshold</strong></td>
<td>(Î¼â‚+Î¼â‚€)/2 + adjustment</td>
<td>Optimal threshold for Gaussian scores</td>
</tr>
</tbody>
</table>

---

## Final Thoughts ğŸŒŸ

Risk segmentation transforms a one-size-fits-all approach into a nuanced, cost-aware decision system. By treating priority tiers as carriers of prior beliefs and cost weights, we can:

- **Optimize decisions** per tier
- **Balance trade-offs** explicitly
- **Allocate resources** efficiently
- **Communicate rationale** clearly

**Key Takeaways:**

âœ… **Priority tiers encode priors** â€” different base rates for different tiers
âœ… **Costs drive thresholds** â€” higher stakes â†’ more aggressive flagging
âœ… **Bayes optimal threshold** â€” Ï„* = Câ‚€â‚ / (Câ‚€â‚ + Câ‚â‚€)
âœ… **Iso-cost lines** â€” visualize cost trade-offs in ROC/PR space
âœ… **Baseline handling** â€” special rules for trusted tiers
âœ… **Gaussian derivation** â€” Ï„* = midpoint + cost/prior adjustment

**Match your thresholds to your costs!** âš–ï¸ğŸ¯

**Tomorrow's Preview:** Day 25 - Configuration Pairing Logic and Equivalence Classes ğŸ”—ğŸ¯

---


