---
Id: 1024
Title: "Day 24: Risk Segmentation: HR/MR/RR/NR as Priors and Costs"
Author: Sughosh P Dixit
Date: "2025-11-24"
Tags: Data Science Risk Segmentation Cost-Sensitive Learning Bayes Threshold Decision Theory Classification Priors
Topic: Data Science
Abstract: "Learn to interpret risk levels as prior beliefs or cost weights. Understand cost-sensitive thresholding, Bayes optimal decision rules, and how per-risk thresholds change labeling geometry through iso-cost analysis."
HeaderImage: /DS-24/risk_segmentation_intro.png
isPublished: true
---

# **Day 24: Risk Segmentation: HR/MR/RR/NR as Priors and Costs** âš–ï¸ğŸ“Š

<p style={{fontStyle: 'italic', color: '#666', marginTop: '1rem', textAlign: 'center'}}>Interpret risk levels as prior beliefs or cost weights. Learn cost-sensitive thresholding and Bayes optimal decisions.</p>

<Lottie animation="analyticsPulse" height={240} width={340} caption="Risk segmentation assigns different decision thresholds based on prior beliefs and misclassification costs, optimizing overall decision quality." />

<p style={{fontStyle: 'italic', color: '#666', margin: '1rem 0 2rem', textAlign: 'center'}}>When different types of errors have different costs, a single threshold isn't optimal. Risk segmentation lets us tune decisions per segment, balancing precision and recall based on business needs.</p>

> ğŸ’¡ **Note:** This article uses technical terms and abbreviations. For definitions, check out the [Key Terms & Glossary](/key) page.

---

## The Problem: One Threshold Doesn't Fit All ğŸ¯

**Scenario:** You have a fraud detection system with four risk segments:

- **HR (High Risk):** Known bad actors, high fraud probability
- **MR (Medium Risk):** Moderate suspicion, needs investigation
- **RR (Regular Risk):** Normal customers, low fraud rate
- **NR (No Risk):** Verified trusted entities

**Question:** Should you use the same decision threshold for all segments?

**Answer:** No! Different segments have different:
- **Prior probabilities** (base rates of fraud)
- **Misclassification costs** (cost of false positives vs false negatives)

**The insight:** Risk levels encode our **prior beliefs** and **cost preferences**! ğŸ’¡

---

## Risk Levels as Prior Beliefs ğŸ²

### What are Priors?

**Prior probability** (Ï€) is our belief about class proportions *before* seeing the score.

**Notation:**
- Ï€â‚ = P(Fraud) = Prior probability of positive class
- Ï€â‚€ = P(Not Fraud) = Prior probability of negative class
- Ï€â‚€ + Ï€â‚ = 1

### Different Priors by Risk Segment

**Example:**
```
Segment    Ï€â‚ (Fraud Rate)    Ï€â‚€ (Not Fraud)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
HR         0.30 (30%)         0.70 (70%)
MR         0.10 (10%)         0.90 (90%)
RR         0.02 (2%)          0.98 (98%)
NR         0.001 (0.1%)       0.999 (99.9%)
```

**Interpretation:**
- **HR:** 1 in 3 events is fraud (high prior)
- **MR:** 1 in 10 events is fraud
- **RR:** 1 in 50 events is fraud
- **NR:** 1 in 1000 events is fraud (very low prior)

**Visual Example:**

<img src="/DS-24/prior_by_segment.png" alt="Prior Probabilities by Risk Segment" style={{maxWidth: '100%', height: 'auto', display: 'block', margin: '1.5rem auto', borderRadius: '8px'}} />

<Lottie animation="robustWorkflow" height={220} width={320} caption="Prior probabilities reflect our baseline expectations for each risk segment before examining individual scores." />

---

## Risk Levels as Cost Weights ğŸ’°

### Misclassification Costs

Not all errors are equal! We define:

- **Câ‚€â‚ (False Positive Cost):** Cost of flagging a legitimate transaction
  - Customer friction, lost business, review time
- **Câ‚â‚€ (False Negative Cost):** Cost of missing a fraud
  - Financial loss, reputational damage, regulatory fines

### Cost Matrix

```
                    Predicted
                 Negative  Positive
Actual  Negative    0        Câ‚€â‚
        Positive   Câ‚â‚€        0
```

### Different Costs by Risk Segment

**Example:**
```
Segment    Câ‚â‚€ (Miss Fraud)    Câ‚€â‚ (False Alarm)    Ratio Câ‚â‚€/Câ‚€â‚
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
HR         $10,000             $50                  200:1
MR         $5,000              $100                 50:1
RR         $1,000              $200                 5:1
NR         $500                $500                 1:1
```

**Interpretation:**
- **HR:** Missing fraud is 200Ã— worse than false alarm â†’ Be aggressive!
- **MR:** Missing fraud is 50Ã— worse â†’ Still favor catching fraud
- **RR:** Missing fraud is 5Ã— worse â†’ More balanced
- **NR:** Costs are equal â†’ Standard threshold

**Visual Example:**

<img src="/DS-24/cost_by_segment.png" alt="Cost Weights by Risk Segment" style={{maxWidth: '100%', height: 'auto', display: 'block', margin: '1.5rem auto', borderRadius: '8px'}} />

---

## Cost-Sensitive Thresholding âš–ï¸

### The Standard Threshold

Without cost considerations, we typically use Ï„ = 0.5:
- If P(Fraud|x) â‰¥ 0.5, predict Fraud
- If P(Fraud|x) < 0.5, predict Not Fraud

### The Bayes Optimal Threshold

With unequal costs and priors, the optimal threshold shifts!

**Bayes Decision Rule:**

Predict Fraud if:
```
P(Fraud|x) Â· Câ‚â‚€ > P(Not Fraud|x) Â· Câ‚€â‚
```

Rearranging:
```
P(Fraud|x) / P(Not Fraud|x) > Câ‚€â‚ / Câ‚â‚€
```

Using odds notation:
```
Odds(Fraud|x) > Câ‚€â‚ / Câ‚â‚€
```

### Deriving the Threshold

**Optimal Threshold Formula:**
```
Ï„* = Câ‚€â‚ / (Câ‚€â‚ + Câ‚â‚€)
```

Or equivalently, incorporating priors:
```
Ï„* = 1 / (1 + (Câ‚â‚€/Câ‚€â‚) Â· (Ï€â‚/Ï€â‚€))
```

**Alternative form (likelihood ratio threshold):**
```
Ï„_LR = (Câ‚€â‚/Câ‚â‚€) Â· (Ï€â‚€/Ï€â‚)
```

**Visual Example:**

<img src="/DS-24/bayes_threshold.png" alt="Bayes Optimal Threshold" style={{maxWidth: '100%', height: 'auto', display: 'block', margin: '1.5rem auto', borderRadius: '8px'}} />

<Lottie animation="breakdownFortress" height={220} width={320} caption="The Bayes optimal threshold balances the costs of different types of errors, shifting based on cost ratios and prior probabilities." />

---

## Per-Risk Thresholds: Changing Labeling Geometry ğŸ“

### Computing Segment-Specific Thresholds

Using the formula Ï„* = Câ‚€â‚ / (Câ‚€â‚ + Câ‚â‚€):

```
Segment    Câ‚â‚€      Câ‚€â‚     Ï„* = Câ‚€â‚/(Câ‚€â‚+Câ‚â‚€)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
HR         $10,000  $50     50/(50+10000) = 0.005
MR         $5,000   $100    100/(100+5000) = 0.020
RR         $1,000   $200    200/(200+1000) = 0.167
NR         $500     $500    500/(500+500) = 0.500
```

**Interpretation:**
- **HR (Ï„* = 0.005):** Flag anything with >0.5% fraud probability
- **MR (Ï„* = 0.020):** Flag anything with >2% fraud probability
- **RR (Ï„* = 0.167):** Flag anything with >16.7% fraud probability
- **NR (Ï„* = 0.500):** Standard 50% threshold

### Impact on Labeling

**Lower threshold â†’ More events flagged (higher recall, lower precision)**
**Higher threshold â†’ Fewer events flagged (higher precision, lower recall)**

**Visual Example:**

<img src="/DS-24/per_risk_thresholds.png" alt="Per-Risk Thresholds" style={{maxWidth: '100%', height: 'auto', display: 'block', margin: '1.5rem auto', borderRadius: '8px'}} />

---

## Visualizing: PR Curves at Different Costs ğŸ“ˆ

### What Changes with Cost?

The **same model** produces different operating points when costs change.

On a Precision-Recall curve:
- Each threshold corresponds to a (Precision, Recall) point
- Different costs select different optimal points
- Higher Câ‚â‚€/Câ‚€â‚ ratio â†’ Move toward higher recall

### Three Operating Points

**Example with three cost scenarios:**

```
Scenario         Câ‚â‚€/Câ‚€â‚    Optimal Ï„    Precision    Recall
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Conservative     1:1        0.50         85%          40%
Balanced         10:1       0.09         60%          75%
Aggressive       100:1      0.01         30%          95%
```

**Visual Example:**

<img src="/DS-24/pr_curve_costs.png" alt="PR Curve with Different Cost Points" style={{maxWidth: '100%', height: 'auto', display: 'block', margin: '1.5rem auto', borderRadius: '8px'}} />

---

## Iso-Cost Lines: Visualizing Cost Trade-offs ğŸ“Š

### What are Iso-Cost Lines?

**Iso-cost lines** connect points with equal expected cost on the ROC or PR space.

**Formula (ROC space):**
```
Expected Cost = Câ‚€â‚ Â· Ï€â‚€ Â· FPR + Câ‚â‚€ Â· Ï€â‚ Â· FNR
              = Câ‚€â‚ Â· Ï€â‚€ Â· FPR + Câ‚â‚€ Â· Ï€â‚ Â· (1 - TPR)
```

For constant cost C:
```
TPR = 1 - (C - Câ‚€â‚ Â· Ï€â‚€ Â· FPR) / (Câ‚â‚€ Â· Ï€â‚)
```

This is a **linear equation** with slope:
```
slope = (Câ‚€â‚ Â· Ï€â‚€) / (Câ‚â‚€ Â· Ï€â‚)
```

### Reading Iso-Cost Lines

**Properties:**
- Lines closer to top-left corner = lower cost
- Slope depends on cost ratio and priors
- Optimal point = where ROC curve is tangent to iso-cost line

**Different slopes for different segments:**
```
Segment    Slope = (Câ‚€â‚Â·Ï€â‚€)/(Câ‚â‚€Â·Ï€â‚)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
HR         (50Â·0.70)/(10000Â·0.30) = 0.012
MR         (100Â·0.90)/(5000Â·0.10) = 0.18
RR         (200Â·0.98)/(1000Â·0.02) = 9.8
NR         (500Â·0.999)/(500Â·0.001) = 999
```

**Visual Example:**

<img src="/DS-24/iso_cost_lines.png" alt="Iso-Cost Lines on ROC Space" style={{maxWidth: '100%', height: 'auto', display: 'block', margin: '1.5rem auto', borderRadius: '8px'}} />

<Lottie animation="classicalVsRobust" height={220} width={320} caption="Iso-cost lines help visualize how different cost structures lead to different optimal operating points on the ROC curve." />

---

## NR Handling: Special Case ğŸ”’

### What Makes NR Different?

**NR (No Risk)** segments often receive special treatment:

1. **Very low prior:** Ï€â‚ â‰ˆ 0.001 or less
2. **Equal or inverted costs:** Câ‚€â‚ â‰¥ Câ‚â‚€ (false positives hurt more)
3. **Business rules:** May bypass scoring entirely

### NR Handling Strategies

**Strategy 1: High Threshold**
```
Ï„_NR = 0.90  (Only flag very high scores)
```

**Strategy 2: Bypass**
```
if segment == NR:
    return "Auto-Approve"  # Skip scoring
```

**Strategy 3: Score but Don't Flag**
```
# Score for monitoring, but don't take action
if segment == NR:
    tag = "Monitor-Only"
```

### Impact on Labeling Geometry

When NR uses different rules:
- The decision boundary shifts dramatically
- Creates discontinuity in the overall labeling
- Requires careful tracking of segment-specific metrics

**Visual Example:**

<img src="/DS-24/nr_handling.png" alt="NR Handling Strategies" style={{maxWidth: '100%', height: 'auto', display: 'block', margin: '1.5rem auto', borderRadius: '8px'}} />

---

## Real-World Application: Per-Risk Threshold Configuration ğŸ”§

### Configuration Structure

```python
risk_config = {
    'HR': {
        'prior': 0.30,
        'cost_fn': 10000,  # Câ‚â‚€: cost of missing fraud
        'cost_fp': 50,     # Câ‚€â‚: cost of false positive
        'threshold': 0.005,
        'action': 'flag_for_review'
    },
    'MR': {
        'prior': 0.10,
        'cost_fn': 5000,
        'cost_fp': 100,
        'threshold': 0.020,
        'action': 'flag_for_review'
    },
    'RR': {
        'prior': 0.02,
        'cost_fn': 1000,
        'cost_fp': 200,
        'threshold': 0.167,
        'action': 'flag_if_above'
    },
    'NR': {
        'prior': 0.001,
        'cost_fn': 500,
        'cost_fp': 500,
        'threshold': 0.500,
        'action': 'auto_approve'
    }
}
```

### Applying Per-Risk Thresholds

```python
def apply_risk_threshold(event, score, risk_config):
    """
    Apply risk-specific threshold to determine action.
    
    Parameters:
    - event: Event dictionary with 'risk_segment'
    - score: Model score (probability)
    - risk_config: Configuration dictionary
    
    Returns:
    - action: 'flag', 'approve', or 'monitor'
    """
    segment = event['risk_segment']
    config = risk_config[segment]
    threshold = config['threshold']
    
    if config['action'] == 'auto_approve':
        return 'approve'
    elif score >= threshold:
        return 'flag'
    else:
        return 'approve'
```

---

## Exercise: Deriving the Decision Threshold ğŸ“

### The Problem

**Given:**
- Two classes with Gaussian score distributions
- Class 0 (Not Fraud): N(Î¼â‚€, ÏƒÂ²)
- Class 1 (Fraud): N(Î¼â‚, ÏƒÂ²) where Î¼â‚ > Î¼â‚€
- Priors: Ï€â‚€, Ï€â‚
- Costs: Câ‚€â‚ (false positive), Câ‚â‚€ (false negative)

**Derive:** The optimal decision threshold Ï„*

### Solution

**Step 1: Bayes Decision Rule**

Predict Class 1 (Fraud) if:
```
Ï€â‚ Â· P(x|Class 1) Â· Câ‚â‚€ > Ï€â‚€ Â· P(x|Class 0) Â· Câ‚€â‚
```

**Step 2: Likelihood Ratio**

Rearranging:
```
P(x|Class 1) / P(x|Class 0) > (Câ‚€â‚/Câ‚â‚€) Â· (Ï€â‚€/Ï€â‚)
```

Let Î» = (Câ‚€â‚/Câ‚â‚€) Â· (Ï€â‚€/Ï€â‚) be the **threshold likelihood ratio**.

**Step 3: Gaussian Likelihood Ratio**

For Gaussian distributions with equal variance:
```
P(x|Class 1) / P(x|Class 0) = exp[-(x-Î¼â‚)Â²/2ÏƒÂ² + (x-Î¼â‚€)Â²/2ÏƒÂ²]
                            = exp[(Î¼â‚-Î¼â‚€)(2x-Î¼â‚-Î¼â‚€) / 2ÏƒÂ²]
```

**Step 4: Solve for Threshold**

Setting likelihood ratio = Î»:
```
(Î¼â‚-Î¼â‚€)(2x-Î¼â‚-Î¼â‚€) / 2ÏƒÂ² = ln(Î»)
```

Solving for x:
```
Ï„* = (Î¼â‚ + Î¼â‚€)/2 + ÏƒÂ² Â· ln(Î») / (Î¼â‚ - Î¼â‚€)
```

**Step 5: Simplify**

Substituting Î» = (Câ‚€â‚/Câ‚â‚€) Â· (Ï€â‚€/Ï€â‚):
```
Ï„* = (Î¼â‚ + Î¼â‚€)/2 + ÏƒÂ² Â· ln[(Câ‚€â‚/Câ‚â‚€) Â· (Ï€â‚€/Ï€â‚)] / (Î¼â‚ - Î¼â‚€)
```

### Interpretation

The optimal threshold has two components:

1. **Midpoint:** (Î¼â‚ + Î¼â‚€)/2 â€” where distributions cross
2. **Shift:** Adjustment based on costs and priors

**When Câ‚â‚€ > Câ‚€â‚ (missing fraud is worse):**
- Î» < 1, ln(Î») < 0
- Threshold shifts left (lower)
- More events flagged

**When Ï€â‚ > Ï€â‚€ (fraud is common):**
- Î» smaller
- Threshold shifts left
- More events flagged

**Visual Example:**

<img src="/DS-24/gaussian_threshold.png" alt="Gaussian Score Distributions and Optimal Threshold" style={{maxWidth: '100%', height: 'auto', display: 'block', margin: '1.5rem auto', borderRadius: '8px'}} />

---

## Best Practices for Risk-Based Thresholding âœ…

### 1. Estimate Priors Carefully

- Use historical data to estimate segment-specific fraud rates
- Update priors regularly as patterns change
- Consider seasonal variations

### 2. Quantify Costs Explicitly

- Work with business stakeholders to define costs
- Include both direct and indirect costs
- Document assumptions

### 3. Validate Thresholds Empirically

- Backtest on historical data
- Monitor performance by segment
- Adjust based on observed outcomes

### 4. Handle Edge Cases

- Define behavior for missing segments
- Plan for new/unknown risk categories
- Set sensible defaults

### 5. Document Everything

- Record threshold derivations
- Track cost assumptions
- Log threshold changes over time

### 6. Monitor Segment Drift

- Watch for changes in segment composition
- Alert on significant prior shifts
- Recalibrate periodically

---

## Summary Table ğŸ“‹

<table>
<thead>
<tr>
<th>Concept</th>
<th>Formula</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Prior Probability</strong></td>
<td>Ï€â‚ = P(Fraud)</td>
<td>Base rate of positive class</td>
</tr>
<tr>
<td><strong>Cost Ratio</strong></td>
<td>Câ‚â‚€ / Câ‚€â‚</td>
<td>How much worse is missing fraud vs false alarm</td>
</tr>
<tr>
<td><strong>Bayes Threshold</strong></td>
<td>Ï„* = Câ‚€â‚ / (Câ‚€â‚ + Câ‚â‚€)</td>
<td>Cost-optimal decision boundary</td>
</tr>
<tr>
<td><strong>Likelihood Ratio</strong></td>
<td>Î» = (Câ‚€â‚/Câ‚â‚€) Â· (Ï€â‚€/Ï€â‚)</td>
<td>Threshold in likelihood space</td>
</tr>
<tr>
<td><strong>Iso-Cost Slope</strong></td>
<td>(Câ‚€â‚ Â· Ï€â‚€) / (Câ‚â‚€ Â· Ï€â‚)</td>
<td>Slope of equal-cost lines in ROC</td>
</tr>
<tr>
<td><strong>Gaussian Threshold</strong></td>
<td>(Î¼â‚+Î¼â‚€)/2 + adjustment</td>
<td>Optimal threshold for Gaussian scores</td>
</tr>
</tbody>
</table>

---

## Final Thoughts ğŸŒŸ

Risk segmentation transforms a one-size-fits-all approach into a nuanced, cost-aware decision system. By treating risk levels as carriers of prior beliefs and cost weights, we can:

- **Optimize decisions** per segment
- **Balance trade-offs** explicitly
- **Allocate resources** efficiently
- **Communicate rationale** clearly

**Key Takeaways:**

âœ… **Risk levels encode priors** â€” different base rates for different segments
âœ… **Costs drive thresholds** â€” higher stakes â†’ more aggressive flagging
âœ… **Bayes optimal threshold** â€” Ï„* = Câ‚€â‚ / (Câ‚€â‚ + Câ‚â‚€)
âœ… **Iso-cost lines** â€” visualize cost trade-offs in ROC/PR space
âœ… **NR handling** â€” special rules for trusted segments
âœ… **Gaussian derivation** â€” Ï„* = midpoint + cost/prior adjustment

**Match your thresholds to your costs!** âš–ï¸ğŸ¯

**Tomorrow's Preview:** Day 25 - Coming soon! ğŸ“ŠğŸ¯

---


